<!DOCTYPE html>
<html>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<head>
  <style>
body {
  margin: 0;
  padding: 0;
  background: #f7f7f7;
  font-family: -apple-system, BlinkMacSystemFont, Tahoma;
  text-align: center;
}

.container {
  max-width: 420px;
  margin: auto;
  padding: 16px;
}

h2 {
  font-size: 22px;
  margin-bottom: 12px;
}

#reader {
  width: 100% !important;
  border-radius: 12px;
  overflow: hidden;
}

#result {
  margin-top: 20px;
  padding: 16px;
  background: white;
  border-radius: 12px;
  font-size: 22px;
  line-height: 1.8;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.price {
  font-size: 32px;
  font-weight: bold;
  color: #1a7f37;
}
</style>
<meta charset="UTF-8">
<title>Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù‚ÛŒÙ…Øª</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
  body {
    margin: 0;
    font-family: Tahoma;
    background: #f5f5f5;
  }

  #reader {
    width: 100%;
    max-width: 420px;
    height: 320px;
    margin: 20px auto;
    border-radius: 12px;
    overflow: hidden;
  }

  #result {
    font-size: 22px;
    margin-top: 15px;
  }
</style>
</head>
<body>

<div class="container">

  <h2>ðŸ“· Ø§Ø³Ú©Ù† Ø¨Ø§Ø±Ú©Ø¯ Ú©Ø§Ù„Ø§</h2>

  <div id="reader"></div>

  <div id="result">
    Ù…Ù†ØªØ¸Ø± Ø§Ø³Ú©Ù†...
  </div>

</div>
<script>
  let lastCode = null;
let scanLock = false;
  
const sheetUrl = "https://docs.google.com/spreadsheets/d/1fHjsbAzLQQhbMAMzjvYt2d6LMuBhpBRU98gO30Xdl-s/export?format=csv";

fetch(sheetUrl)
  .then(res => res.text())
  .then(data => {
    const rows = data.split("\n").map(r => r.split(","));
    window.products = rows.slice(1).map(r => ({
      barcode: r[0],
      name: r[1],
      price: r[2]
    }));
  });

const html5QrCode = new Html5Qrcode("reader");

html5QrCode.start(
  {
    facingMode: { exact: "environment" }
  },
  {
    fps: 15,
    qrbox: { width: 250, height: 250 },
    disableFlip: true,
    experimentalFeatures: {
      useBarCodeDetectorIfSupported: true
    }
  },
  (code) => {
  if (scanLock) return;
  if (code === lastCode) return;

  scanLock = true;
  lastCode = code;

  const p = products.find(x => x.barcode.trim() === code.trim());

  document.getElementById("result").innerHTML =
    p
      ? `ðŸ“¦ ${p.name}<br><span class="price">ðŸ’° ${p.price}</span>`
      : "âŒ ÛŒØ§ÙØª Ù†Ø´Ø¯";

  // Ø¨Ø¹Ø¯ Ø§Ø² Û± Ø«Ø§Ù†ÛŒÙ‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Ú©Ù† Ø¨Ø¹Ø¯ÛŒ
  setTimeout(() => {
    scanLock = false;
  }, 1000);
}
</script>

</body>
</html>
